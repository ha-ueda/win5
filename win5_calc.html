<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>WIN5 本命あり買い目計算ツール</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {
    font-family: "Segoe UI", sans-serif;
    margin: 20px;
    background: #f9fafb;
    color: #333;
}
h1 {
    font-size: 22px;
    margin-bottom: 15px;
}
.race-row {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    margin-bottom: 10px;
}
label {
    width: 100%;
    max-width: 60px;
    margin-bottom: 4px;
}
input {
    width: calc(100% - 70px);
    max-width: 200px;
    padding: 8px;
    margin-right: 8px;
    box-sizing: border-box;
    margin-bottom: 5px;
}
select {
    padding: 8px;
    margin-left: 5px;
    margin-bottom: 5px;
}
button {
    width: 100%;
    max-width: 300px;
    padding: 12px;
    background-color: #0078d4;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 16px;
}
button:hover {
    background-color: #005fa3;
}
#result {
    margin-top: 20px;
    font-weight: bold;
    font-size: 18px;
}
#combos {
    margin-top: 15px;
    width: 100%;
    height: 300px;
    padding: 10px;
    font-family: monospace;
    font-size: 16px;
    overflow: auto;
    box-sizing: border-box;
}
@media (max-width: 600px) {
    input {
        width: 100%;
        margin-right: 0;
    }
    button {
        max-width: 100%;
    }
}
</style>
</head>
<body>

<h1>WWIN5 本命あり買い目計算ツール</h1>

<div>
<div class="race-row">
<label>WIN1:</label>
馬番 <input type="text" id="r1" value="" placeholder="例:3,5,8">
本命 <input type="text" id="f1" value="" placeholder="例:5">
</div>
<div class="race-row">
<label>WIN2:</label>
馬番 <input type="text" id="r2" value="" placeholder="例:1,4,6">
本命 <input type="text" id="f2" value="" placeholder="例:4">
</div>
<div class="race-row">
<label>WIN3:</label>
馬番 <input type="text" id="r3" value="" placeholder="例:2,7,8,9">
本命 <input type="text" id="f3" value="" placeholder="例:7">
</div>
<div class="race-row">
<label>WIN4:</label>
馬番 <input type="text" id="r4" value="" placeholder="例:1,5">
本命 <input type="text" id="f4" value="" placeholder="例:5">
</div>
<div class="race-row">
<label>WIN5:</label>
馬番 <input type="text" id="r5" value="" placeholder="例:2,3">
本命 <input type="text" id="f5" value="" placeholder="例:2">
</div>

<div style="margin-top:15px;">
本命が最低
<select id="minFav">
<option value="1" selected>1</option>
<option value="2">2</option>
<option value="3">3</option>
<option value="4">4</option>
<option value="5">5</option>
</select> 頭 当たらないとハズレ
</div>

<button onclick="calc()">計算する</button>
</div>

<div id="result"></div>
<textarea id="combos" readonly placeholder="まとめた買い目がここに表示されます"></textarea>

<script>
// 数字 → 丸数字変換
function toCircleNumber(num) {
    if (num >= 1 && num <= 20) {
        const circleNums = ['①','②','③','④','⑤','⑥','⑦','⑧','⑨','⑩',
                            '⑪','⑫','⑬','⑭','⑮','⑯','⑰','⑱','⑲','⑳'];
        return circleNums[num-1];
    }
    return num.toString();
}

// 入力文字列 → 数字配列
function parseInput(str) {
    if (!str.trim()) return [];
    return str.split(',').map(s => Number(s.trim())).filter(n => !isNaN(n));
}

// デカルト積
function cartesian(arrays) {
    return arrays.reduce((a,b)=>a.flatMap(d=>b.map(e=>[...d,e])),[[]]);
}

// n個からk個選ぶ組み合わせ
function combinations(arr, k){
    let results = [];
    function helper(start, comb){
        if (comb.length===k){ results.push([...comb]); return; }
        for (let i=start;i<arr.length;i++){
            comb.push(arr[i]);
            helper(i+1, comb);
            comb.pop();
        }
    }
    helper(0,[]);
    return results;
}

function calc() {
    const r = [
        parseInput(document.getElementById('r1').value),
        parseInput(document.getElementById('r2').value),
        parseInput(document.getElementById('r3').value),
        parseInput(document.getElementById('r4').value),
        parseInput(document.getElementById('r5').value)
    ];
    const f = [
        parseInput(document.getElementById('f1').value),
        parseInput(document.getElementById('f2').value),
        parseInput(document.getElementById('f3').value),
        parseInput(document.getElementById('f4').value),
        parseInput(document.getElementById('f5').value)
    ];

    const minFav = Number(document.getElementById('minFav').value);
    let valid = 0;
    let comboList = [];

    // 本命頭数順に生成
    for (let k = 5; k >= minFav; k--) {
        comboList.push(`--- 本命が${k}頭当たる組み合わせ ---`);
        const masks = combinations([0,1,2,3,4], k);
        masks.forEach(mask => {
            let candidates = [];
            for (let i=0;i<5;i++){
                if (mask.includes(i)) {
                    candidates.push(f[i]);
                } else {
                    candidates.push(r[i].filter(x=>!f[i].includes(x)));
                }
            }
            // 丸数字＆スペース区切り
            comboList.push(candidates.map(arr=>arr.map(toCircleNumber).join('')).join('-'));
            valid += cartesian(candidates).length;
        });
    }

    document.getElementById('result').innerHTML =
        `買い目：<span style="color:#0078d4;">${valid.toLocaleString()}</span> 通り`;

    document.getElementById('combos').value = comboList.join('\n');
}
</script>

</body>
</html>
