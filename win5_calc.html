<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>WIN5 本命あり買い目計算ツール</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: "Segoe UI", sans-serif; margin: 20px; background: #f9fafb; color: #333; }
h1 { font-size: 22px; margin-bottom: 15px; }

.race-row {
    margin-bottom: 15px;
    padding: 10px;
    border: 2px solid #cce0ff;
    border-radius: 8px;
    background-color: #f0f8ff;
}

.race-label { font-weight: bold; margin-bottom: 8px; font-size: 18px; }

.checks-container {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.checks {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
}

.checks label {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 55px;
    height: 70px;
    font-size: 16px;
}

.checks input {
    transform: scale(2.2);
    margin-bottom: 6px;
}

.check-buttons {
    margin-top: 6px;
}

.check-buttons button {
    margin-right: 6px;
    padding: 4px 8px;
    font-size: 14px;
}

select {
    font-size: 18px;
    padding: 8px 12px;
}

#result { margin-top: 20px; font-weight: bold; font-size: 18px; }
#combos { margin-top: 15px; width: 100%; height: 300px; padding: 10px; font-family: monospace; font-size: 16px; box-sizing: border-box; white-space: pre-wrap; word-wrap: break-word; }

button.calc-btn {
    width: 100%;
    max-width: 300px;
    padding: 14px;
    background-color: #0078d4;
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 18px;
    margin-top: 10px;
}
button.calc-btn:hover { background-color: #005fa3; }
</style>
</head>
<body>

<h1>WIN5 本命あり買い目計算ツール</h1>

<div id="races"></div>

<div style="margin-top:15px;">
本命が最低
<select id="minFav">
<option value="1" selected>1</option>
<option value="2">2</option>
<option value="3">3</option>
<option value="4">4</option>
<option value="5">5</option>
</select> 頭当たらないとハズレ
</div>

<button class="calc-btn" onclick="calc()">計算する</button>

<div id="result"></div>
<textarea id="combos" readonly placeholder="まとめた買い目がここに表示されます"></textarea>

<script>
// 数字 → 丸数字 (1〜18)
function toCircleNumber(num) {
    const circleNums = ['①','②','③','④','⑤','⑥','⑦','⑧','⑨','⑩',
                        '⑪','⑫','⑬','⑭','⑮','⑯','⑰','⑱'];
    if (num >=1 && num <=18) return circleNums[num-1];
    return num.toString();
}

// チェックボックス生成（本命先）
function createRaceCheckboxes(raceNum) {
    const container = document.createElement('div');
    container.className = 'race-row';

    const label = document.createElement('div');
    label.className = 'race-label';
    label.textContent = `WIN${raceNum}`;
    container.appendChild(label);

    const checksContainer = document.createElement('div');
    checksContainer.className = 'checks-container';

    // 本命
    const favDiv = document.createElement('div');
    favDiv.textContent = '本命';
    const favChecks = document.createElement('div');
    favChecks.className = `checks r${raceNum}-fav`;
    for (let i=1;i<=18;i++){
        const l = document.createElement('label');
        l.innerHTML = `<input type="checkbox" value="${i}">${i}`;
        favChecks.appendChild(l);
    }

    // 本命用ボタン
    const favButtons = document.createElement('div');
    favButtons.className = 'check-buttons';
    favButtons.innerHTML = `<button type="button" onclick="checkAll('r${raceNum}-fav')">全てチェック</button>
                            <button type="button" onclick="uncheckAll('r${raceNum}-fav')">全て解除</button>`;
    favDiv.appendChild(favChecks);
    favDiv.appendChild(favButtons);

    // 馬番
    const horseDiv = document.createElement('div');
    horseDiv.textContent = '紐';
    const horseChecks = document.createElement('div');
    horseChecks.className = `checks r${raceNum}-horse`;
    for (let i=1;i<=18;i++){
        const l = document.createElement('label');
        l.innerHTML = `<input type="checkbox" value="${i}">${i}`;
        horseChecks.appendChild(l);
    }

    // 紐用ボタン
    const horseButtons = document.createElement('div');
    horseButtons.className = 'check-buttons';
    horseButtons.innerHTML = `<button type="button" onclick="checkAll('r${raceNum}-horse')">全てチェック</button>
                              <button type="button" onclick="uncheckAll('r${raceNum}-horse')">全て解除</button>`;
    horseDiv.appendChild(horseChecks);
    horseDiv.appendChild(horseButtons);

    checksContainer.appendChild(favDiv);
    checksContainer.appendChild(horseDiv);

    container.appendChild(checksContainer);
    document.getElementById('races').appendChild(container);
}

// 5レース作成
for(let i=1;i<=5;i++) createRaceCheckboxes(i);

// 全てチェック
function checkAll(className){
    document.querySelectorAll(`.${className} input`).forEach(input => input.checked = true);
}

// 全て解除
function uncheckAll(className){
    document.querySelectorAll(`.${className} input`).forEach(input => input.checked = false);
}

// チェックボックス値取得
function getCheckedValues(className) {
    return Array.from(document.querySelectorAll(`.${className} input:checked`)).map(i=>Number(i.value));
}

// デカルト積
function cartesian(arrays) {
    return arrays.reduce((a,b)=>a.flatMap(d=>b.map(e=>[...d,e])),[[]]);
}

// n個からk個選ぶ
function combinations(arr,k){
    let results=[];
    function helper(start, comb){
        if(comb.length===k){ results.push([...comb]); return; }
        for(let i=start;i<arr.length;i++){ comb.push(arr[i]); helper(i+1,comb); comb.pop(); }
    }
    helper(0,[]);
    return results;
}

// 計算
function calc(){
    const r=[], f=[];
    for(let i=1;i<=5;i++){
        let horses = getCheckedValues(`r${i}-horse`);
        let favs = getCheckedValues(`r${i}-fav`);
        if(horses.length===0 && favs.length>0) horses = [...favs]; // 紐未選択なら本命補完
        r.push(horses);
        f.push(favs);
    }

    const minFav = Number(document.getElementById('minFav').value);
    let totalValid = 0, comboList=[];

    for(let k=5;k>=minFav;k--){
        const masks = combinations([0,1,2,3,4], k);
        let validForK = 0;

        masks.forEach(mask=>{
            let candidates = [];
            for(let i=0;i<5;i++){
                if(mask.includes(i)) candidates.push(f[i]);
                else candidates.push(r[i].filter(x=>!f[i].includes(x)));
            }
            if(candidates.every(arr=>arr.length>0)) validForK += cartesian(candidates).length;
        });

        comboList.push(`--- 本命が${k}頭当たる組み合わせ ${validForK}通り ---`);

        if(validForK > 0){
            masks.forEach(mask=>{
                let candidates = [];
                for(let i=0;i<5;i++){
                    if(mask.includes(i)) candidates.push(f[i]);
                    else candidates.push(r[i].filter(x=>!f[i].includes(x)));
                }
                if(candidates.every(arr=>arr.length>0)){
                    const line = candidates.map(arr=>arr.map(toCircleNumber).join('')).join('-');
                    comboList.push(line);
                }
            });
        }

        totalValid += validForK;
    }

    document.getElementById('result').innerHTML = `総買い目：<span style="color:#0078d4;">${totalValid.toLocaleString()}</span> 通り`;
    document.getElementById('combos').value = comboList.join('\n');
}
</script>

</body>
</html>
