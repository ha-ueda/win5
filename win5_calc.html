<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>WIN5 本命あり買い目計算ツール</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: "Segoe UI", sans-serif; margin: 20px; background: #f9fafb; color: #333; }
h1 { font-size: 22px; margin-bottom: 15px; }
.race-row { margin-bottom: 15px; }
.race-label { font-weight: bold; margin-bottom: 5px; }
.checks { display: flex; flex-wrap: wrap; }
.checks label { width: 35px; margin-right: 5px; margin-bottom: 5px; text-align: center; }
#result { margin-top: 20px; font-weight: bold; font-size: 18px; }
#combos { margin-top: 15px; width: 100%; height: 300px; padding: 10px; font-family: monospace; font-size: 16px; overflow: auto; box-sizing: border-box; }
button { width: 100%; max-width: 300px; padding: 12px; background-color: #0078d4; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; margin-top: 10px; }
button:hover { background-color: #005fa3; }
</style>
</head>
<body>

<h1>WIN5 本命あり買い目計算ツール</h1>

<div id="races"></div>

<div style="margin-top:15px;">
本命が最低
<select id="minFav">
<option value="1" selected>1</option>
<option value="2">2</option>
<option value="3">3</option>
<option value="4">4</option>
<option value="5">5</option>
</select> 頭当たらないとハズレ
</div>

<button onclick="calc()">計算する</button>

<div id="result"></div>
<textarea id="combos" readonly placeholder="まとめた買い目がここに表示されます"></textarea>

<script>
// 数字 → 丸数字
function toCircleNumber(num) {
    if (num >= 1 && num <= 18) {
        const circleNums = ['①','②','③','④','⑤','⑥','⑦','⑧','⑨','⑩',
                            '⑪','⑫','⑬','⑭','⑮','⑯','⑰','⑱'];
        return circleNums[num-1];
    }
    return num.toString();
}

// チェックボックスを生成
function createRaceCheckboxes(raceNum) {
    const container = document.createElement('div');
    container.className = 'race-row';
    const label = document.createElement('div');
    label.className = 'race-label';
    label.textContent = `WIN${raceNum}`;
    container.appendChild(label);

    // 馬番チェックボックス
    const horseDiv = document.createElement('div');
    horseDiv.textContent = '馬番: ';
    const horseChecks = document.createElement('span');
    horseChecks.className = 'checks';
    for (let i=1; i<=18; i++) {
        const l = document.createElement('label');
        l.innerHTML = `<input type="checkbox" class="r${raceNum}-horse" value="${i}"> ${i}`;
        horseChecks.appendChild(l);
    }
    horseDiv.appendChild(horseChecks);
    container.appendChild(horseDiv);

    // 本命チェックボックス
    const favDiv = document.createElement('div');
    favDiv.textContent = '本命: ';
    const favChecks = document.createElement('span');
    favChecks.className = 'checks';
    for (let i=1; i<=18; i++) {
        const l = document.createElement('label');
        l.innerHTML = `<input type="checkbox" class="r${raceNum}-fav" value="${i}"> ${i}`;
        favChecks.appendChild(l);
    }
    favDiv.appendChild(favChecks);
    container.appendChild(favDiv);

    document.getElementById('races').appendChild(container);
}

// 5レース分作る
for (let i=1; i<=5; i++) createRaceCheckboxes(i);

// チェックボックスから配列取得
function getCheckedValues(className) {
    return Array.from(document.querySelectorAll(`.${className}:checked`)).map(i => Number(i.value));
}

// デカルト積
function cartesian(arrays) {
    return arrays.reduce((a,b)=>a.flatMap(d=>b.map(e=>[...d,e])),[[]]);
}

// n個からk個選ぶ組み合わせ
function combinations(arr, k){
    let results = [];
    function helper(start, comb){
        if (comb.length===k){ results.push([...comb]); return; }
        for (let i=start;i<arr.length;i++){
            comb.push(arr[i]);
            helper(i+1, comb);
            comb.pop();
        }
    }
    helper(0,[]);
    return results;
}

function calc() {
    const r = [];
    const f = [];
    for (let i=1; i<=5; i++) {
        r.push(getCheckedValues(`r${i}-horse`));
        f.push(getCheckedValues(`r${i}-fav`));
    }
    const minFav = Number(document.getElementById('minFav').value);
    let valid = 0;
    let comboList = [];

    for (let k=5; k>=minFav; k--) {
        comboList.push(`--- 本命が${k}頭当たる組み合わせ ---`);
        const masks = combinations([0,1,2,3,4], k);
        masks.forEach(mask => {
            let candidates = [];
            for (let i=0;i<5;i++){
                if (mask.includes(i)) {
                    candidates.push(f[i]);
                } else {
                    candidates.push(r[i].filter(x=>!f[i].includes(x)));
                }
            }
            comboList.push(candidates.map(arr=>arr.map(toCircleNumber).join('')).join('-'));
            valid += cartesian(candidates).length;
        });
    }

    document.getElementById('result').innerHTML =
        `買い目：<span style="color:#0078d4;">${valid.toLocaleString()}</span> 通り`;

    document.getElementById('combos').value = comboList.join('\n');
}
</script>

</body>
</html>
